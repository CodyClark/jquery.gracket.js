(function(e){e.fn.gracket=function(n){e.fn.gracket.defaults={gracketClass:"g_gracket",gameClass:"g_game",roundClass:"g_round",teamClass:"g_team",winnerClass:"g_winner",spacerClass:"g_spacer",currentClass:"g_current",cornerRadius:15,canvasId:"g_canvas",canvasClass:"g_canvas",canvasLineColor:"#eee",canvasLineCap:"round",canvasLineWidth:2,canvasLineGap:15,src:{}};if("object"!==typeof JSON)return e.error("json2 does not exsist. Please add the script to your head!");var m=this,o=JSON.parse(m.data("gracket"))|| JSON.parse(this.gracket.defaults.src),s,t,v;e.fn.gracket.settings={};var q={init:function(a){this.gracket.settings=e.extend({},this.gracket.defaults,a);this.gracket.settings.canvasId=this.gracket.settings.canvasId+"_"+(new Date).getTime();a=document.createElement("canvas");a.id=this.gracket.settings.canvasId;a.className=this.gracket.settings.canvasClass;a.style.position="absolute";a.style.left=0;a.style.top=0;a.style.right="auto";m.addClass(this.gracket.settings.gracketClass).prepend(a);t=o.length; for(a=0;a<t;a++){var i=g.build.round(this.gracket.settings);m.append(i);v=o[a].length;for(var b=0;b<v;b++){var c=g.build.game(this.gracket.settings),j=m.find("."+this.gracket.settings.gameClass).outerHeight(!0),j=g.build.spacer(this.gracket.settings,j,a,0!==a&&0===b?!0:!1);0==b%1&&0!==a&&i.append(j);i.append(c);s=o[a][b].length;for(j=0;j<s;j++){var w=g.build.team(o[a][b][j],this.gracket.settings);c.append(w);1===s&&(c.prev().remove(),g.align.winner(c,this.gracket.settings,c.parent().prev().children().eq(0).height()), g.listeners(this.gracket.settings,o,c.parent().prev().children().eq(1)))}}}}},g={build:{team:function(a,i){return team=e("<div />",{html:"<h3><span>"+(a.seed||0)+"</span> "+a.name+"</h3>","class":i.teamClass+" "+(a.id||"id_null")})},game:function(a){return game=e("<div />",{"class":a.gameClass})},round:function(a){return round=e("<div />",{"class":a.roundClass})},spacer:function(a,i,b,c){return spacer=e("<div />",{"class":a.spacerClass}).css({height:c?(Math.pow(2,b)-1)*(i/2):(Math.pow(2,b)-1)*i})}, canvas:{resize:function(a){a=document.getElementById(a.canvasId);a.height=m.innerHeight();a.width=m.innerWidth();e(a).css({height:m.innerHeight(),width:m.innerWidth(),zIndex:1,pointerEvents:"none"})},draw:function(a,i,b){var c=document.getElementById(a.canvasId);"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(c);var c=c.getContext("2d"),j=b.outerWidth(!0),g=b.outerHeight(!0),n=parseInt(m.css("paddingLeft"))||0,o=parseInt(m.css("paddingTop"))||0;parseInt(b.css("marginBottom")); var s=j+n,p=parseInt(m.find("> div").css("marginRight"))||0,d=a.cornerRadius,u=a.canvasLineGap,q=b.height()-2*b.find("> div").eq(1).height();_playerHt=b.find("> div").eq(1).height();d>g/3&&(d=g/3);d>p/2&&(d=p/2-2);0>=d&&(d=1);u>p/3&&(u=p/3);c.strokeStyle=a.canvasLineColor;c.lineCap=a.canvasLineCap;c.lineWidth=a.canvasLineWidth;c.beginPath();for(var b=Math.pow(2,i.length-2),k=0,r,t=0.5,v=0===k&&1===b?!0:!1;1<=b;){for(r=0;r<b;r++){1==b&&(t=1);var f=s+k*j+k*p,l=t*p,h=((Math.pow(2,k-1)-0.5)*(k&&1)+r* Math.pow(2,k))*g+o+_playerHt+q/2;if(v)var h=e("."+a.gameClass),f=h.eq(h.length-1),x=f.outerHeight(!0),f=f.outerWidth(!0)+n,h=((Math.pow(2,k-1)-0.5)*(k&&1)+r*Math.pow(2,k))*x+o+h.find("> div").eq(1).height()+q/2;c.moveTo(f+u,h);1<b?c.lineTo(f+l-d,h):c.lineTo(f+l-u,h);b<Math.pow(2,i.length-2)&&(c.moveTo(f-j-u,h),c.lineTo(f-j-0.5*p,h));1<b&&0==r%2&&(c.moveTo(f+l,h+d),c.lineTo(f+l,h+Math.pow(2,k)*g-d),l=f+l-d,f=h+d,c.moveTo(l,f-d),c.arcTo(l+d,f-d,l+d,f,d),f=h+Math.pow(2,k)*g-d,c.moveTo(l+d,f-d),c.arcTo(l+ d,f+d,l,f+d,d))}k++;b/=2}c.stroke()}}},align:{winner:function(a,e,b){b=1===a.parent().siblings().not("canvas").length?b-(a.height()+a.height()/2):b+a.height()/2;return a.addClass(e.winnerClass).css({"margin-top":b})}},listeners:function(a,i,b){e.each(e("."+a.teamClass+" > h3"),function(){var b="."+e(this).parent().attr("class").split(" ")[1];void 0!==b&&e(b).hover(function(){e(b).addClass(a.currentClass)},function(){e(b).removeClass(a.currentClass)})});g.build.canvas.resize(a);g.build.canvas.draw(a, i,b)}};if(q[n])return q[n].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof n||!n)return q.init.apply(this,arguments);e.error('Method "'+n+'" does not exist in gracket!')}})(jQuery);