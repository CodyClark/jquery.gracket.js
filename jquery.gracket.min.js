// jquery.gracket.js
// Erik M. Zettersten
// https://github.com/erik5388/jquery.gracket.js
// MIT
// Version 1.5.5


(function(g){g.fn.gracket=function(r){g.fn.gracket.defaults={gracketClass:"g_gracket",gameClass:"g_game",roundClass:"g_round",roundLabelClass:"g_round_label",teamClass:"g_team",winnerClass:"g_winner",spacerClass:"g_spacer",currentClass:"g_current",cornerRadius:15,canvasId:"g_canvas",canvasClass:"g_canvas",canvasLineColor:"#eee",canvasLineCap:"round",canvasLineWidth:2,canvasLineGap:15,roundLabels:[],src:[]};var i=this,k="undefined"===typeof i.data("gracket")?[]:JSON.parse(i.data("gracket")),s,t,z;
g.fn.gracket.settings={};var u={init:function(a){this.gracket.settings=g.extend({},this.gracket.defaults,a);this.gracket.settings.src.length&&(k=this.gracket.settings.src);this.gracket.settings.canvasId=this.gracket.settings.canvasId+"_"+(new Date).getTime();a=document.createElement("canvas");a.id=this.gracket.settings.canvasId;a.className=this.gracket.settings.canvasClass;a.style.position="absolute";a.style.left=0;a.style.top=0;a.style.right="auto";i.addClass(this.gracket.settings.gracketClass).prepend(a);
t=k.length;for(a=0;a<t;a++){var d=l.build.round(this.gracket.settings);i.append(d);z=k[a].length;for(var b=0;b<z;b++){var c=l.build.game(this.gracket.settings),f=i.find("."+this.gracket.settings.gameClass).outerHeight(!0),f=l.build.spacer(this.gracket.settings,f,a,0!==a&&0===b?!0:!1);0==b%1&&0!==a&&d.append(f);d.append(c);s=k[a][b].length;for(f=0;f<s;f++){var p=l.build.team(k[a][b][f],this.gracket.settings);c.append(p);1===s&&(c.prev().remove(),l.align.winner(c,this.gracket.settings,c.parent().prev().children().eq(0).height()),
l.listeners(this.gracket.settings,k,c.parent().prev().children().eq(1)))}}}}},l={build:{team:function(a,d){return team=g("<div />",{html:"<h3><span>"+(a.seed||0)+"</span> "+a.name+"</h3>","class":d.teamClass+" "+(a.id||"id_null")})},game:function(a){return game=g("<div />",{"class":a.gameClass})},round:function(a){return round=g("<div />",{"class":a.roundClass})},spacer:function(a,d,b,c){return spacer=g("<div />",{"class":a.spacerClass}).css({height:c?(Math.pow(2,b)-1)*(d/2):(Math.pow(2,b)-1)*d})},
labels:function(a,d){var b,c=a.length,f;for(b=0;b<c;b++)f=0===b?d.padding+d.width*b:d.padding+d.width*b+d.right*b,g("<h5 />",{text:d.labels.length?d.labels[b]:"Round "+(b+1),"class":d["class"]}).css({position:"absolute",left:f,width:d.width}).prependTo(i)},canvas:{resize:function(a){a=document.getElementById(a.canvasId);a.height=i.innerHeight();a.width=i.innerWidth();g(a).css({height:i.innerHeight(),width:i.innerWidth(),zIndex:1,pointerEvents:"none"})},draw:function(a,d,b){var c=document.getElementById(a.canvasId);
"undefined"!=typeof G_vmlCanvasManager&&G_vmlCanvasManager.initElement(c);var c=c.getContext("2d"),f=b.outerWidth(!0),p=b.outerHeight(!0),k=parseInt(i.css("paddingLeft"))||0,r=parseInt(i.css("paddingTop"))||0;parseInt(b.css("marginBottom"));var s=f+k,q=parseInt(i.find("> div").css("marginRight"))||0,e=a.cornerRadius,v=a.canvasLineGap,u=b.height()-2*b.find("> div").eq(1).height();_playerHt=b.find("> div").eq(1).height();"undefined"!==typeof console&&console.info("Padding Left: "+k+"px","Player/Name Width: "+
f+"px","Container padding left: "+s+"px");e>p/3&&(e=p/3);e>q/2&&(e=q/2-2);0>=e&&(e=1);v>q/3&&(v=q/3);c.strokeStyle=a.canvasLineColor;c.lineCap=a.canvasLineCap;c.lineWidth=a.canvasLineWidth;c.beginPath();var b=Math.pow(2,d.length-2),m=0,w,t=0.5,x=0===m&&1===b?!0:!1;if(x)var y=g("."+a.gameClass),f=y.eq(y.length-1),p=f.outerHeight(!0),f=f.outerWidth(!0);for(;1<=b;){for(w=0;w<b;w++){1==b&&(t=1);var h=x?f+k:s+m*f+m*q,j=t*q,n=((Math.pow(2,m-1)-0.5)*(m&&1)+w*Math.pow(2,m))*p+r+(x?y.find("> div").eq(1).height():
_playerHt)+u/2;c.moveTo(h+v,n);1<b?c.lineTo(h+j-e,n):c.lineTo(h+j-v,n);b<Math.pow(2,d.length-2)&&(c.moveTo(h-f-v,n),c.lineTo(h-f-0.5*q,n));1<b&&0==w%2&&(c.moveTo(h+j,n+e),c.lineTo(h+j,n+Math.pow(2,m)*p-e),h=h+j-e,j=n+e,c.moveTo(h,j-e),c.arcTo(h+e,j-e,h+e,j,e),j=n+Math.pow(2,m)*p-e,c.moveTo(h+e,j-e),c.arcTo(h+e,j+e,h,j+e,e))}m++;b/=2}c.stroke();l.build.labels(d,{width:f,padding:k,left:s,right:q,labels:a.roundLabels,"class":a.roundLabelClass})}}},align:{winner:function(a,d,b){b=1===a.parent().siblings().not("canvas").length?
b-(a.height()+a.height()/2):b+a.height()/2;return a.addClass(d.winnerClass).css({"margin-top":b})}},listeners:function(a,d,b){g.each(g("."+a.teamClass+" > h3"),function(){var b="."+g(this).parent().attr("class").split(" ")[1];void 0!==b&&g(b).hover(function(){g(b).addClass(a.currentClass)},function(){g(b).removeClass(a.currentClass)})});l.build.canvas.resize(a);l.build.canvas.draw(a,d,b)}};if(u[r])return u[r].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof r||!r)return u.init.apply(this,
arguments);g.error('Method "'+r+'" does not exist in gracket!')}})(jQuery);